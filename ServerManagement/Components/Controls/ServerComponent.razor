@inject NavigationManager? NavigationManager

@if (server != null)
{
    <EditForm Model="server"
              FormName="serverComponentForm" OnSubmit="ChangeServerStatus">
        <InputNumber @bind-Value="server.ServerId" class="form-control" hidden></InputNumber>
        <InputText @bind-Value="server.Name" class="form-control" hidden />
        <InputText @bind-Value="server.City" class="form-control" hidden />
        <InputCheckbox id="IsOnline" @bind-Value="server.IsOnline" class="form-check-input" hidden />


        <div data-name="@server.Name"
             data-status="@(server.IsOnline ? "online" : "offline")"
             style=" color:@(server.IsOnline ? "green" : "red")">
            <span style="min-width:250px;display:inline-block">@server.Name, @server.City, @(server.IsOnline ? "online" : "offline")</span>
            &nbsp;
            <button class="btn btn-primary" type="submit">Turn On/Off</button>
        </div>
    </EditForm>
}
else
{
    <p>No server data...</p>
}


@code {
    [SupplyParameterFromForm]
    private Server? server { get; set; } //= new Server {Name = "Server-" + Random.Shared.Next(1, 11),};

    protected override void OnParametersSet()
    {
        // server ??= new Server { Name = "Server 1", City = "Toronto", IsOnline = false };
        server ??= (ServersRepository.GetServerById(Random.Shared.Next(1, ServersRepository.GetServersMaxId() + 1))) ??
    ServersRepository.GetServerById(ServersRepository.GetServersMinId());
    }

    private void ChangeServerStatus()
    {
        if (server != null)
        {
            server.IsOnline = !server.IsOnline;
            ServersRepository.UpdateServer(server.ServerId, server);
            NavigationManager?.NavigateTo("/servers", forceLoad: true);
        }
    }
}
